<template>
  <div class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">{{ workspaceConfig.title }}</h1>
        <p class="text-slate-400">{{ workspaceConfig.description }}</p>
      </div>

      <div class="flex flex-wrap gap-2 mb-8 bg-slate-800 p-1 rounded-lg">
        <button
          v-for="tab in tabs"
          :key="tab.id"
          @click="activeTab = tab.id"
          :class="[
            'flex items-center space-x-2 px-4 py-2 rounded-md font-medium transition-colors text-sm sm:text-base',
            activeTab === tab.id
              ? 'bg-slate-700 text-white shadow-sm'
              : 'text-slate-400 hover:text-white'
          ]"
        >
          <component :is="tab.icon" class="h-4 w-4" />
          <span>{{ tab.label }}</span>
        </button>
      </div>

      <div class="space-y-8">
        <transition name="fade-transform" mode="out-in">
          <div v-if="activeTab === 'upload'" class="bg-slate-850 border border-slate-800 rounded-xl shadow-lg p-8">
            <h2 class="text-2xl font-semibold text-white mb-6">Unggah Set Data</h2>
            
            <div
              ref="dropZoneRef"
              :class="[
                'border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition-colors',
                isOverDropZone
                  ? 'border-blue-500 bg-slate-800'
                  : 'border-slate-700 hover:border-blue-500'
              ]"
              @click="open"
            >
              <input ref="fileInput" type="file" @change="onFileChange" accept=".csv,.xls,.xlsx" class="hidden" />
              <Upload class="h-12 w-12 text-slate-500 mx-auto mb-4" />
              <h3 class="text-lg font-medium text-white mb-2">
                {{ isOverDropZone ? 'Jatuhkan file di sini' : 'Unggah set data Anda' }}
              </h3>
              <p class="text-slate-400 mb-4">
                Seret dan jatuhkan file CSV atau Excel Anda, atau klik untuk menelusuri
              </p>
              <div class="text-sm text-slate-500">
                Format yang didukung: CSV, XLS, XLSX (Ukuran maks: 10MB)
              </div>
            </div>

            <div v-if="uploadedFile" class="mt-6 p-4 bg-green-900/50 border border-green-800 rounded-lg">
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-medium text-green-300">File berhasil diunggah!</h4>
                  <p class="text-green-400">{{ uploadedFile.name }}</p>
                </div>
                <button
                  @click="activeTab = 'process'"
                  class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
                >
                  Proses Data
                </button>
              </div>
            </div>
          </div>

          <DataProcessing v-else-if="activeTab === 'process'" :has-data="!!uploadedFile" @process-complete="isDataProcessed = true" />
          <DataVisualization v-else-if="activeTab === 'visualize'" :has-data="!!uploadedFile" :is-processed="isDataProcessed" />
          <ModelTraining v-else-if="activeTab === 'train'" :has-data="!!uploadedFile" :is-processed="isDataProcessed" />
        </transition>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { useRoute } from 'vue-router';
import { useDropZone } from '@vueuse/core';
import { Upload, BarChart3, SlidersHorizontal, Play } from 'lucide-vue-next';
import DataVisualization from '../components/DataVisualization.vue';
import ModelTraining from '../components/ModelTraining.vue';
import DataProcessing from '../components/DataProcessing.vue';

const route = useRoute();

const workspaceConfig = computed(() => {
  const path = route.path;
  if (path.includes('data-mining')) {
    return {
      title: 'Ruang Kerja Penambangan Data',
      description: 'Lingkungan lengkap Anda untuk penambangan data, analisis, dan pelatihan model machine learning.'
    };
  }
  if (path.includes('data-science')) {
    return {
      title: 'Ruang Kerja Sains Data',
      description: 'Lingkungan lengkap Anda untuk eksplorasi sains data, pemodelan, dan analisis mendalam.'
    };
  }
  return {
    title: 'Ruang Kerja Analisis Data',
    description: 'Lingkungan lengkap Anda untuk analisis data, visualisasi, dan penemuan wawasan.'
  };
});

const uploadedFile = ref<File | null>(null);
const isDataProcessed = ref(false);
const activeTab = ref('upload');

const dropZoneRef = ref<HTMLDivElement>();
const fileInput = ref<HTMLInputElement>();

function handleFiles(files: File[] | null) {
  if (files && files.length > 0) {
    if (files[0].size > 10 * 1024 * 1024) {
      alert("Ukuran file tidak boleh melebihi 10MB.");
      return;
    }
    uploadedFile.value = files[0];
    activeTab.value = 'process';
    isDataProcessed.value = false;
  }
}

const { isOverDropZone } = useDropZone(dropZoneRef, {
  onDrop: handleFiles,
  dataTypes: ['text/csv', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet']
});

function onFileChange(event: Event) {
  const target = event.target as HTMLInputElement;
  handleFiles(target.files ? Array.from(target.files) : null);
}

function open() {
  fileInput.value?.click();
}

const tabs = [
  { id: 'upload', label: '1. Unggah', icon: Upload },
  { id: 'process', label: '2. Proses Data', icon: SlidersHorizontal },
  { id: 'visualize', label: '3. Visualisasikan', icon: BarChart3 },
  { id: 'train', label: '4. Latih Model', icon: Play },
];
</script>

<style scoped>
.fade-transform-enter-active,
.fade-transform-leave-active {
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.fade-transform-enter-from {
  opacity: 0;
  transform: translateY(20px);
}
.fade-transform-leave-to {
  opacity: 0;
  transform: translateY(-20px);
}
</style>
